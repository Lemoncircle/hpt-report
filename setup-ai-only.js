#!/usr/bin/env node

/**
 * Setup Script for AI-Only Mode
 * This script helps configure the HPT Report App for AI-only analysis
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log('üöÄ HPT Report App - AI-Only Mode Setup');
console.log('=====================================\n');

console.log('This script will configure your app for AI-only analysis mode.');
console.log('You will need a Perplexity API key to proceed.\n');

console.log('üìã What you need:');
console.log('1. Perplexity API account (https://www.perplexity.ai/)');
console.log('2. Valid API key with sufficient credits\n');

rl.question('Do you have a Perplexity API key? (y/n): ', (hasKey) => {
  if (hasKey.toLowerCase() !== 'y') {
    console.log('\n‚ùå You need a Perplexity API key to use AI-only mode.');
    console.log('\nüìù Steps to get your API key:');
    console.log('1. Visit https://www.perplexity.ai/');
    console.log('2. Sign up for an account');
    console.log('3. Navigate to API settings');
    console.log('4. Generate a new API key');
    console.log('5. Run this script again with your API key\n');
    rl.close();
    return;
  }

  rl.question('Enter your Perplexity API key: ', (apiKey) => {
    if (!apiKey || apiKey.trim().length === 0) {
      console.log('\n‚ùå Invalid API key. Please try again.');
      rl.close();
      return;
    }

    // Create .env.local file
    const envContent = `# HPT Report App - AI Configuration
# Generated by setup-ai-only.js on ${new Date().toISOString()}

# Perplexity API Configuration
PERPLEXITY_API_KEY=${apiKey.trim()}

# AI-Only Mode Configuration
ENABLE_AI_INSIGHTS=true
AI_FALLBACK_ENABLED=false

# This configuration ensures:
# ‚úÖ All analysis uses AI for maximum insight quality
# ‚úÖ No fallback to rule-based analysis
# ‚úÖ Consistent AI-powered reports for all employees
# ‚úÖ Advanced features like behavioral recommendations and risk analysis
`;

    const envPath = path.join(process.cwd(), '.env.local');
    
    try {
      fs.writeFileSync(envPath, envContent);
      
      console.log('\n‚úÖ Configuration complete!');
      console.log('\nüìÅ Created: .env.local');
      console.log('\nüéØ AI-Only Mode Enabled:');
      console.log('   ‚Ä¢ ENABLE_AI_INSIGHTS=true');
      console.log('   ‚Ä¢ AI_FALLBACK_ENABLED=false');
      console.log('\nüöÄ Next Steps:');
      console.log('1. Start your development server: npm run dev');
      console.log('2. Upload an Excel file to test AI analysis');
      console.log('3. All reports will now use AI-powered insights');
      console.log('\nüí° Benefits of AI-Only Mode:');
      console.log('   ‚Ä¢ Superior analysis quality');
      console.log('   ‚Ä¢ Personalized insights for each employee');
      console.log('   ‚Ä¢ Predictive performance analysis');
      console.log('   ‚Ä¢ Advanced behavioral recommendations');
      console.log('   ‚Ä¢ Risk factor identification');
      console.log('   ‚Ä¢ Team-level strategic insights');
      
      console.log('\nüìñ For more information, see AI_SETUP.md');
      console.log('\nüîí Security Note: Your API key is stored locally and never shared.');
      
    } catch (error) {
      console.log('\n‚ùå Error creating configuration file:', error.message);
      console.log('\nPlease create .env.local manually with the following content:');
      console.log('\n' + envContent);
    }
    
    rl.close();
  });
}); 